# Supabase Type Usage Guidelines

This project uses generated Supabase database typings to provide end-to-end type safety. Regenerate the file whenever migrations change to keep runtime behavior and compile-time checks in sync.

## Supabase Type Generation

- Run `npm run supabase:types` to parse the local baseline schema and emit `src/types/database.ts`.
- The CI entry point `npm run ci:verify` invokes the same command before running `eslint`, helping prevent outdated definitions from reaching main.
- The generated file is marked with “Auto-generated by Supabase” and should not be edited manually.

## Using the `Database` Type

- Import `Database` from `src/types/database` and feed it into Supabase client generics:

  ```ts
  import { createClient } from '@supabase/supabase-js';
  import type { Database } from '@/types/database';

  const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_KEY);
  ```

- Narrow individual tables for stronger guarantees:

  ```ts
  type WorkerRow = Database['public']['Tables']['workers']['Row'];
  type WorkerInsert = Database['public']['Tables']['workers']['Insert'];
  ```

- Prefer `Insert` when constructing payloads and `Row` when handling query results to catch missing fields early.
- The Database type is the single source of truth for public schema tables—lean on it to avoid hand-written interfaces.

## Domain Types

- Higher level interfaces such as `Worker`, `Project`, and the reusable filter/response helpers live in `src/types/app.ts`.
- Import from `@/types` to access both generated database types and these domain helpers thanks to the barrel file (`src/types/index.ts`).

## When Things Change

- Any migration that adds columns, tables, enums, or RLS helpers must be followed by `npm run supabase:types`.
- Expect the script to overwrite `src/types/database.ts`; commit the diff alongside the schema change.
- If CI fails complaining about outdated types, re-run the command locally and push the regenerated file.
